{% extends "adminas/layout.html" %}

{% load static %}
{% load get_item_description %}

{% block title %}
    - Job #TODO
{% endblock %}

{% block javascript %}
    <script>
        const JOB_ID = '{{ job.id }}';
        const URL_ITEMS = '{% url "items" %}';
        //const ADD_PO_URL = "{% url 'purchase_order' %}";
    </script>
    <script src="{% static 'adminas/toggle-job-forms.js' %}" type="text/javascript"></script>
    <script src="{% static 'adminas/items_form.js' %}" type="text/javascript"></script>
    <script src="{% static 'adminas/items_edit.js' %}" type="text/javascript"></script>
    <script src="{% static 'adminas/item_info.js' %}" type="text/javascript"></script>
    <!--<script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>-->
{% endblock %}

{% block body %}
    <h2>Job {{ job.name }} for {{ job.customer.name }}</h2>
    <h3>General Details</h3>
    <div id="job_general_section">
        <h4>Identification</h4>
        <div class="read_row">
            Agent: {{ job.agent.name }}
        </div>
        <div class="read_row">
            Customer: {{ job.customer.name }}
        </div>
        <div class="read_row">
            Quote ref: {{ job.quote_ref }}
        </div>
        <div class="read_row">
            Country: {{ job.country.name }}
        </div>
        <div class="read_row">
            Language: {{ job.language }}
        </div>
    </div>

    <div class="payment_and_delivery_container">
        <div id="job_payment_section">
            <h4>Payment</h4>
            <div class="read_row panel">
                Invoice address:<br />
                {{ job.invoice_to.address }}, {{ job.invoice_to.region }}, {{ job.invoice_to.postcode }}, {{ job.invoice_to.country.name }}
            </div>
            <div class="read_row">
                Currency: {{ job.currency }}
            </div>
            <div class="read_row panel">
                Payment terms:<br />
                {{ job.payment_terms }}
            </div>
        </div>
        <div id="job_delivery_section">
            <h4>Delivery</h4>
            <div class="read_row panel">
                Delivery address:<br />
                {{ job.delivery_to.address }}, {{ job.delivery_to.region }}, {{ job.delivery_to.postcode }}, {{ job.delivery_to.country.name }}
            </div>
            <div class="read_row">
                Incoterm: {{ job.incoterm_code }} {{ job.incoterm_location }}
            </div>
        </div>
    </div>

    <div id="job_po_section">
        <h3>Purchase Order</h3>
        <div class="job-po-container">
            {% for po in po_list %}
                <div class="po-row">"{{ po.reference }}" dated {{ po.date_on_po }} for {{ po.currency }} {{ po.value_f }} [edit TODO]</div>
            {% endfor %}
        </div>
        <div class="job-po-form-container">
            <button id="toggle_po_form_btn">Add PO</button>
            <form method="POST" action="{% url 'purchase_order' %}" class="hide" id="po_form">
                {% csrf_token %}
                {{ po_form }}
                <input type='submit' action='submit' id='po_submit_button' value='submit'>
            </form>
        </div>
    </div>

    <div id="job_items_section">
        <h3>Items</h3>
        <div class="job-items-container">

            <div class="existing-items-container">
    {% for it in item_list %}
                <div class="job-item-container">
                    <div class="item-sect-what"><span class="quantity">{{ it.quantity }}</span> x <span class="product">{{ it.product }}</span></div>
                    <div class="item-full-desc">{% get_item_description it.product job.language %}</div>
                    <div class="item-sect-money"><span class="currency">{{ job.currency }}</span><span class="selling_price">{{ it.selling_price_f }}</span></div>
                    <div class="item-sect-check"><span class="price_list">{{ it.price_list }}</span></div>
                    <button class="ji-edit" data-jiid="{{ it.id }}">edit</button>
                </div>
    {% endfor %}
            </div>

    {% if not item_list.is_empty %}
            <button id="toggle_item_form_btn">add items</button>
            <div id="new_items_container" class="hide">
    {% else %}
        <button id="toggle_item_form_btn" class="hide">add items</button>
            <div id="new_items_container">
    {% endif %}
                <div class="add-multiple">
                    Add <input type="number" id="add_multi_items"> items <button id="add_multi_items_btn">add items</button>
                </div>
                <form method="POST" action="{% url 'items' %}" id="items_form">
                    {% csrf_token %}
                    {{ item_formset.management_form }}
                {% for form in item_formset %}
                    <div class="form-row">
                        <label for="{{ form.quantity.auto_id }}">{{ form.quantity.label }}</label>
                        {{ form.quantity }}
                        <label for="{{ form.product.auto_id }}">{{ form.product.label }}</label>
                        {{ form.product }}
                        <label for="{{ form.selling_price.auto_id }}">{{ form.selling_price.label }}</label>
                        {{ form.selling_price }}
                        <label for="{{ form.price_list.auto_id }}">{{ form.price_list.label }}</label>
                        {{ form.price_list }}
                        <button class="remove-item-btn btn-danger">-</button><button id="add_item_btn" class="btn-success">+</button>
                    </div>
                {% endfor %}
                    <input type="submit" action="submit" id="items_submit_button" value="submit">
                </form>
            </div>
        </div>
    </div>

    <!--<script src="{% static 'adminas/scripts.jsx' %}" type="text/babel"></script>-->

{% endblock %}


