{% extends 'adminas/layout.html' %}
{% load static %}


{% block title %}
    - Comments on Job {{ job.name }}
{% endblock %}

{% block javascript %}
    <script>
        const JOB_ID = '{{ job.id }}';
        const URL_JOB_COMMENTS = "{% url 'job_comments' job.id %}";
        const URL_PINNED_COMMENTS = '{% url "pinned_comments" %}';
    </script>
    <script src="{% static 'adminas/job_comments.js' %}" type="text/javascript"></script>
{% endblock %}


{% block body %}
    <h2>Comments on Job {{ job.name }}</h2>

    <section class="job-identifier-pane">
        <h4>{{ job.name }} <img src="{{ job.flag_url }}" alt="{{ job.flag_alt }}"></h4>
        <p>
    {% if job.customer != None %}
            {{ job.customer }} 
        {% if job.agent != None %}
            (via 
        {% endif %}
    {% endif %}
    {% if job.agent != None %}
        {{ job.agent }}
    {% endif %}
    {% if job.agent != None and job.customer != None %}
    )
    {% endif %}
        @ {{ job.currency }}&nbsp;{{ job.value }}
        </p>
        <a href="{% url 'job' job.id %}">Return to Job</a>
        <section class="comment-container-pinned">
        {% for p in pinned %}
            <article class="one-comment {% if p.private %}private{% else %}public{% endif %} id-{{ p.id }}" data-comment_id="{{ p.id }}" data-is_private="{{ p.private|lower }}" data-is_pinned="true">
                <section class="main">
                    <div class="contents">
                        <p>{{ p.contents }}</p>
                    </div>
                    <div class="controls">
                        <button class="pinned-toggle pinned-status-on">unpin</button>
                {% if p.user_is_owner %}
                        <button class="edit-comment">edit</button>
                {% endif %}
                    </div>
                </section>
                <section class="footer">
                    <div>
                        {{ p.created_by }} on {{ p.created_on }}
                        <span class="privacy-status">
                {% if p.user_is_owner %}
                    {% if p.private %}
                            [PRIVATE_ICON]
                    {% else %}
                            [public_icon]
                    {% endif %}
                {% endif %}
                        </span>
                    </div>
                </section>
            </article>
            {% endfor %}
        </section>
        <button id="id_add_job_comment_with_settings">Add new comment</button>
    </section>

    {% for comment in comments %}
        {% if comment.type == 'section' %}
            {% if comment.need_close %}
        </div>
    </section>
            {% endif %}
    <section>
        <h3>{{ comment.title }}</h3>
        <div class="comment-container-{{ comment.class_suffix }}">
        {% elif comment.type == 'message' %}
            <p>{{ comment.message }}</p>
        
        {% elif comment.type == 'comment' %}

            <article class="one-comment {% if comment.private %}private{% else %}public{% endif %} id-{{ comment.id }}" data-comment_id="{{ comment.id }}" data-is_private="{{ comment.private|lower }}" data-is_pinned="{{ comment.pinned|lower }}">
                <section class="main">
                    <div class="contents">
                        <p>{{ comment.contents }}</p>
                    </div>
                    <div class="controls">
                        <button class="pinned-toggle pinned-status-{% if comment.pinned %}on">unpin{% else %}off">pin{% endif %}</button>
            {% if comment.user_is_owner %}
                        <button class="edit-comment">edit</button>
            {% endif %}
                    </div>
                </section>
                <section class="footer">
                    <div>
                        {{ comment.created_by }} on {{ comment.created_on }}
                        <span class="privacy-status">
            {% if comment.user_is_owner %}
                {% if comment.private %}
                            [PRIVATE_ICON]
                {% else %}
                            [public_icon]
                {% endif %}
            {% endif %}
                        </span>
                    </div>
                </section>
            </article>
        {% endif %}
    {% endfor %}
        </div>
    </section>
{% endblock %}