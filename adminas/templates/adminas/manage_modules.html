{% extends "adminas/layout.html" %}

{% load static %}
{% load get_item_description %}
{% load get_valid_jobitems_for_slot %}
{% load get_num_assigned_modules %}

{% block title %}
    - Module Management
{% endblock %}

{% block javascript %}
    <script src="{% static 'adminas/manage_modules.js' %}" type="text/javascript"></script>
{% endblock %}

{% block body %}
    <h2>Module Management</h2>
    <h2>Job {{ job.name }} for {{ job.customer.name }}</h2>

    {% for jobitem in items %}
        <div>
            <div>
                <h3>{{ jobitem.quantity }} x {{ jobitem.product }}</h3>
                <div class="desc">{% get_item_description jobitem.product job.language %}</div>
            </div>

            {% for slot in jobitem.product.slots.all %}
            <div>
                <div>
                    <h4>{{ slot.name }}</h4>
                    {% get_num_assigned_modules jobitem slot as num_assigned %}
                    {% if num_assigned < slot.quantity_required|add:slot.quantity_optional %}
                        <div>Add slot (?/{{ slot.quantity_required|add:slot.quantity_optional }})</div>
                    {% endif %}
                </div>
                <div>
                {% for existing in jobitem.modules.all %}
                    {% if existing.slot == slot %}
                        <div>{{ existing.child.quantity }} x {{ existing.child.product }}</div>
                    {% endif %}
                {% endfor %}

                {% if num_assigned < slot.quantity_required %}
                    <div class="empty-module-slot" data-slot="{{ slot.id }}" data-parent="{{ jobitem.id }}"><i>Click to fill</i></div>
                {% endif %}
                

                </div>
            </div>
            {% endfor %}
        </div>
    {% endfor %}




{% endblock %}